(this.webpackJsonpstickery=this.webpackJsonpstickery||[]).push([[0],{100:function(e,t){},101:function(e,t,n){"use strict";n.r(t);var r,a=n(0),c=n.n(a),o=n(7),i=n.n(o),u=(n(39),function(e){var t=e.Canvas,n=e.TopBar;return c.a.createElement("div",{style:l},c.a.createElement("div",{style:s},n),c.a.createElement("div",{style:f},t))}),l={position:"fixed",left:0,top:0,right:0,bottom:0},s={position:"fixed",left:0,top:0,right:0,bottom:"95%",backgroundColor:"#262626"},f={position:"fixed",left:0,top:"5%",right:0,bottom:0,backgroundColor:"#1a1a1a"},d=n(2),b=function(e){var t=e.onClick,n=e.style,r=e.children;return c.a.createElement("button",{onClick:t,style:n},r)},m=function(e){var t=e.onClick,n=e.children;return c.a.createElement(b,{style:v,onClick:t},n)},v={float:"left",backgroundColor:"gray"},g=function(e){var t=e.onClickOut,n=e.children,r=Object(a.useRef)(null);Object(a.useEffect)((function(){if(r.current){var e=r.current,t=r.current.parentElement;return document.body.appendChild(e),function(){t&&t.appendChild(e)}}}),[]);var o=Object(a.useCallback)((function(e){e.target===e.currentTarget&&t()}),[t]);return c.a.createElement("div",{id:"modal",ref:r,style:h,onClick:o},c.a.createElement("div",{style:p},n))},p={position:"fixed",left:"5%",top:"5%",right:"5%",bottom:"5%",backgroundColor:"#1a1a1a"},h={position:"fixed",left:0,top:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.7)"},E=function(e){var t=e.closeModal,n=e.isModalOpen,r=e.openModal,a=e.importFile,o=e.Gallery;return c.a.createElement(c.a.Fragment,null,c.a.createElement(m,{onClick:r},"Sfondo"),n&&c.a.createElement(g,{onClickOut:t},c.a.createElement(b,{onClick:a},"scegli file"),c.a.createElement("br",null),c.a.createElement("span",null,"o incolla"),o))},O=n(8),j=n.n(O),k=n(28),y=n(32),C=n(29),w=n(33),x=new(function(e){function t(){var e;return Object(k.a)(this,t),(e=Object(y.a)(this,Object(C.a)(t).call(this,"Stickery"))).images=void 0,e.version(1).stores({images:"++id, name, type, data, size, lastModified"}),e.images=e.table("images"),e}return Object(w.a)(t,e),t}(n(30).a)),M=n(10),L=n(31),F=function(e,t){var n=R(e,t);return console.log(n),n},R=function(e,t){switch(t.t){case"bg":return T(e,t.p)}return e},T=(r="background",function(e,t){return Object(L.a)({},e,Object(M.a)({},r,t))}),z={background:null},B=Object(a.createContext)({}),W=function(){return Object(a.useContext)(B)},A=function(e){var t=e.children,n=Object(a.useReducer)(F,z),r=Object(d.a)(n,2),o={state:r[0],dispatch:r[1]};return c.a.createElement(B.Provider,{value:o},t)},H=n(44),S=function(){var e=Object(a.useState)([]),t=Object(d.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){x.images.toArray().then((function(e){var t=e.map((function(e){var t="/_/images/".concat(e.id,"/").concat(e.name);return{src:t,thumbnail:t,thumbnailWidth:0,thumbnailHeight:0}}));r(t)}))}),[]),c.a.createElement(H,{images:n})},I=function(){var e=function(e){var t=Object(a.useState)(!1),n=Object(d.a)(t,2),r=n[0],c=n[1],o=Object(a.useCallback)((function(){return c(!1)}),[]),i=Object(a.useCallback)((function(){return c(!0)}),[]),u=Object(a.useCallback)((function(){return c(!r)}),[r]);return{b:r,T:i,F:o,t:u,s:c}}(),t=e.b,n=e.T,r=e.F,o=W().dispatch,i=function(e){var t=e.fileChoosen,n=Object(a.useRef)(null),r=Object(a.useCallback)((function(){return n.current&&n.current.click()}),[]);return Object(a.useEffect)((function(){var e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none";var r=function(){var n=e.files&&e.files.length>0&&e.files[0];n&&t(n,"fs")};return e.addEventListener("change",r),document.body.appendChild(e),n.current=e,function(){e.removeEventListener("change",r),document.body.removeChild(e),n.current=null}}),[t]),Object(a.useEffect)((function(){var e=function(e){var n=e.clipboardData;if(n&&n.files&&n.files.length>0){var r=n.files[0];t(r,"paste")}};return document.body.addEventListener("paste",e),function(){document.body.removeEventListener("paste",e)}}),[t]),Object(a.useEffect)((function(){var e=function(e){var n=e.dataTransfer;if(n&&n.files.length>0){var r=n.files[0];t(r,"paste")}};return document.body.addEventListener("drop",e),function(){document.body.removeEventListener("drop",e)}}),[t]),[r]}({fileChoosen:Object(a.useCallback)((function(e){(function(e){var t,n,r;return j.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log(e),a.next=3,j.a.awrap(e.arrayBuffer());case 3:return a.t0=a.sent,a.t1=e.size,a.t2=e.lastModified,a.t3=e.name,a.t4=e.type,t={data:a.t0,size:a.t1,lastModified:a.t2,name:a.t3,type:a.t4},a.next=11,j.a.awrap(x.images.add(t));case 11:return n=a.sent,a.next=14,j.a.awrap(x.images.get(n));case 14:return r=a.sent,console.log(r),a.abrupt("return",Promise.resolve("/_/images/".concat(n,"/").concat(e.name)));case 17:case"end":return a.stop()}}))})(e).then((function(e){return o({t:"bg",p:e})}))}),[o])}),u=Object(d.a)(i,1)[0],l=Object(a.useMemo)((function(){return c.a.createElement(S,null)}),[]);return c.a.createElement(E,{importFile:u,closeModal:r,isModalOpen:t,openModal:n,Gallery:l})},G=n(13),J=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(),n=W().state;Object(a.useEffect)((function(){e.current&&(t.current=new G.fabric.Canvas(e.current,_))}),[]);var r=Object(a.useCallback)((function(){var e=t.current;if(e)if(e.setHeight(window.innerHeight),e.setWidth(window.innerWidth),n.background){var r=n.background;e.setBackgroundImage(r,(function(){G.fabric.Image.fromURL(r,(function(t){var n=Math.min(e.getHeight()/(t.height||1),e.getWidth()/(t.width||1));e.setZoom(n),e.renderAll()}))}))}else e.renderAll()}),[n.background]);return Object(a.useEffect)(r,[n.background,r]),Object(a.useEffect)((function(){return window.addEventListener("resize",r,!1),function(){window.removeEventListener("resize",r,!1)}}),[r]),c.a.createElement("canvas",{style:P,ref:e})},P={position:"absolute",top:0,bottom:0,left:0,right:0},_={interactive:!0};i.a.render(c.a.createElement((function(e){var t=e.children;return c.a.createElement(A,null,t)}),null,c.a.createElement((function(){var e=Object(a.useMemo)((function(){return{TopBar:c.a.createElement(c.a.Fragment,null,c.a.createElement(I,null)),Canvas:c.a.createElement(J,null)}}),[]);return c.a.createElement(u,e)}),null)),document.getElementById("root")),navigator.serviceWorker.register("sw.js")},34:function(e,t,n){e.exports=n(101)},39:function(e,t,n){},98:function(e,t){},99:function(e,t){}},[[34,1,2]]]);
//# sourceMappingURL=main.a28651c2.chunk.js.map