(this.webpackJsonpstickery=this.webpackJsonpstickery||[]).push([[0],{26:function(e,t,n){e.exports=n(37)},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(4),c=n.n(a),o=n(0),u=n.n(o),i=Object(o.createContext)({dispatch:function(e){e.consumable&&!e.consumed?(console.warn(e,new Error("Command not consumed")),e.deferred.resolve(e.notConsumedResponse)):e.handled||(console.warn(e,new Error("Action not handled")),e.deferred.resolve(e.notConsumedResponse))}}),s=function(){return Object(o.useContext)(i)},l=function(e){var t=e.mw,n=e.children,r=s(),a=Object(o.useMemo)((function(){return{dispatch:function(e){var n=t(e,r.dispatch);n&&r.dispatch(n)}}}),[t,r]);return u.a.createElement(i.Provider,{value:a},n)},f=function(e){return m(e,void 0,!1)},m=function(e,t,n){var r=Symbol("".concat(e)),a=function a(c){if("function"===typeof c){var o=c;return function(e){var t=a(e);return o(t),t}}var u=c,i={resolve:function(){},reject:function(){}},s=new Promise((function(e,t){i.reject=t,i.resolve=e}));return{type:e,payload:u,symbol:r,handled:!1,consumed:!1,response:s,deferred:i,notConsumedResponse:t,consumable:n}},o=function(e){return!!function(e){return!!e&&"symbol"in e&&e.symbol===r}(e)&&(e.handled=!0)};a.is=o;a.do=function(e,t){if(o(e))return e.handled=!0,t(e.payload)};return a.consume=function(e,t){var r;return c.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!n||!o(e)){a.next=10;break}if(!e.consumed){a.next=4;break}return console.error(e,new Error("Action already consumed!")),a.abrupt("return");case 4:return e.consumed=!0,e.handled=!0,a.next=8,c.a.awrap(Promise.resolve(t(e.payload)));case 8:r=a.sent,e.deferred.resolve(r);case 10:case"end":return a.stop()}}))},a},d=function(e,t){return Object(o.useCallback)((function(n){return e(t)(n)}),[t,e])},b=function(e){var t=s().dispatch;return d(e,t)},p=n(12),v=n(3),h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jpg";return Object(v.a)({},e,{lastModified:1111,name:"noname",src:"https://picsum.photos/".concat(e.width,"/").concat(e.height,".").concat(t),type:t})},j=f("cmd_prj_set_background"),g=f("cmd_prj_add_object"),O=f("cmd_prj_new_project"),y={background:h({width:Math.ceil(1e3*Math.random()+200),height:Math.ceil(1e3*Math.random()+200)}),name:"",objects:[{image:h({width:Math.ceil(200*Math.random()+200),height:Math.ceil(200*Math.random()+200)})}]},E=function(e,t){if(O.is(t))return Object(v.a)({},t.payload,{objects:[]});if(e){if(j.is(t))return Object(v.a)({},e,{background:t.payload});if(g.is(t))return Object(v.a)({},e,{objects:[].concat(Object(p.a)(e.objects),[t.payload])})}return e},w=function(){var e=Object(o.useReducer)(E,y),t=Object(r.a)(e,2),n=t[0],a=t[1];return Object(o.useMemo)((function(){return{state:n,dispatch:a}}),[a,n])},k=n(17),x=n(24),C=n(18),M=n(25),P=function(e){function t(){var e;return Object(k.a)(this,t),(e=Object(x.a)(this,Object(C.a)(t).call(this,"Stickery"))).projects=void 0,e.imageData=void 0,e.imageMeta=void 0,e.version(1).stores({imageData:"src, blob",imageMeta:"src, name, type, size, lastModified",projects:"++id, name, background, objects"}),e.imageData=e.table("imageData"),e.imageMeta=e.table("imageMeta"),e.projects=e.table("projects"),e}return Object(M.a)(t,e),t}(n(19).a),_=Object(o.createContext)(new P),S=function(e){return function(e,t){return"/_/images/".concat(t,"/").concat(e)}(e,Math.random().toString(36).substr(2,9))};function R(e,t){var n,r,a;return c.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return n=e.size,o.next=3,c.a.awrap(e.arrayBuffer());case 3:return r=o.sent,a={blob:r,src:t,size:n},o.abrupt("return",a);case 6:case"end":return o.stop()}}))}function D(e,t){return c.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,r){var a=e.name,c=e.lastModified,o=e.type,u=URL.createObjectURL(e),i=new Image;i.onload=function(){var e={height:i.height,width:i.width,lastModified:c,name:a,type:o,src:t};n(e)},i.src=u})));case 1:case"end":return n.stop()}}))}var I,F=f("cmd_int_set_DB_images"),L=f("cmd_int_add_image_meta"),B={images:[]},A=function(e,t){return F.is(t)?Object(v.a)({},e,{images:t.payload}):L.is(t)?Object(v.a)({},e,{images:[t.payload].concat(Object(p.a)(e.images))}):e},N=m("cmd_import_image_file",null,!0),T=function(){var e=Object(o.useReducer)(A,B),t=Object(r.a)(e,2),n=t[0],a=t[1],u=Object(o.useContext)(_),i=d(L,a),s=Object(o.useCallback)((function(e){N.consume(e,(function(e){return function(e,t){var n,r,a;return c.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return n=S(t.name),o.next=3,c.a.awrap(D(t,n));case 3:return r=o.sent,o.next=6,c.a.awrap(R(t,n));case 6:return a=o.sent,o.abrupt("return",Promise.all([e.imageData.add(a),e.imageMeta.add(r)]).then((function(){return{imageData:a,imageMeta:r}})));case 8:case"end":return o.stop()}}))}(u,e).then((function(e){var t=e.imageMeta;return i(t),t}))})),a(e)}),[i,u,a]);return Object(o.useEffect)((function(){u.imageMeta.toArray().then(F(s))}),[s,u]),Object(o.useMemo)((function(){return{state:n,dispatch:s}}),[s,n])},z=n(8),G=function(){return e={project:w(),imageDB:T()},Object(o.useMemo)((function(){var t=Object.keys(e),n=t.reduce((function(t,n){return function(r){e[n].dispatch(r),t(r)}}),(function(e){}));return{state:t.reduce((function(t,n){return Object(v.a)({},t,Object(z.a)({},n,e[n].state))}),{}),dispatch:n,mw:function(e,t){return n(e),e}}}),[e]);var e},W=Object(o.createContext)(null),J=function(e){var t=e.srvcs,n=e.children;return u.a.createElement(W.Provider,{value:t},n)},U=function(){var e=Object(o.useContext)(W);if(!e)throw new Error("no StickeryServicesCtx");return e.state},V=function(e){return u.a.createElement("button",e,e.children)},X=function(e){var t=e.GalleryItems,n=e.openFileChooser;return u.a.createElement("div",{style:K},u.a.createElement("div",{style:Q},u.a.createElement(V,{onClick:n},"scegli file"),u.a.createElement("br",null),u.a.createElement("span",null,"o incolla")),u.a.createElement("div",{style:Z},t.map((function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return u.a.createElement(a,{key:n})}))))},Y=function(e){var t=e.image,n=e.clickImage;return u.a.createElement("div",{style:q,onClick:n},u.a.createElement("img",{style:H,src:t.src,alt:t.name}))},H={width:"100%"},q={maxWidth:"100%",borderColor:"light-gray",borderWidth:.8,padding:"3px",margin:"3px"},K={display:"grid",gridTemplate:'\n  "head" 20px\n  "gallery" auto\n  ',position:"absolute",top:0,bottom:0},Q={gridArea:"head"},Z={gridArea:"gallery",overflowY:"auto",overflowX:"hidden"},$=function(e){var t=e.clickImage,n=U().imageDB.images,a=function(e){var t=e.onFileChoosen,n=Object(o.useRef)(null),r=Object(o.useCallback)((function(){return n.current&&n.current.click()}),[]);return Object(o.useEffect)((function(){var e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none";var r=function(){var n=e.files&&e.files.length>0&&e.files[0];n&&t(n,"fs")};return e.addEventListener("change",r),document.body.appendChild(e),n.current=e,function(){e.removeEventListener("change",r),document.body.removeChild(e),n.current=null}}),[t]),Object(o.useEffect)((function(){var e=function(e){var n=e.clipboardData;if(n&&n.files&&n.files.length>0){var r=n.files[0];t(r,"paste")}};return document.body.addEventListener("paste",e),function(){document.body.removeEventListener("paste",e)}}),[t]),Object(o.useEffect)((function(){var e=function(e){var n=e.dataTransfer;if(n&&n.files.length>0){var r=n.files[0];t(r,"drop")}};return document.body.addEventListener("drop",e),function(){document.body.removeEventListener("drop",e)}}),[t]),[r]}({onFileChoosen:b(N)}),c=Object(r.a)(a,1)[0],i=Object(o.useMemo)((function(){return n.map((function(e){return[e.src,function(){return u.a.createElement(ee,{image:e,clickImage:t})}]}))}),[t,n]),s=Object(o.useMemo)((function(){return{openFileChooser:c,GalleryItems:i}}),[i,c]);return u.a.createElement(X,s)},ee=function(e){var t=e.image,n=e.clickImage,r=Object(o.useMemo)((function(){return{image:t,clickImage:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return n(t)}))}}),[n,t]);return u.a.createElement(Y,r)},te=n(23),ne=function(e){var t=e.GalleryComp,n=e.formik,a=e.background,c=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(o.useState)(e),n=Object(r.a)(t,2),a=n[0],c=n[1],u=Object(o.useCallback)((function(){return c(!1)}),[]),i=Object(o.useCallback)((function(){return c(!0)}),[]),s=Object(o.useCallback)((function(){return c(!a)}),[a]);return Object(o.useMemo)((function(){return{b:a,T:i,F:u,t:s,s:c}}),[a,u,i,s])}(),i=c.b,s=c.T,l=c.F;return u.a.createElement("div",null,u.a.createElement("h2",null,"Scegli lo sfondo e il nome"),u.a.createElement("input",{name:"name",onChange:n.handleChange,value:n.values.name}),a&&u.a.createElement("img",{src:a,alt:"bg"}),i?u.a.createElement(t,{done:l}):u.a.createElement(V,{onClick:s},"scegli da gallery"),n.isValid&&u.a.createElement(V,{onClick:n.submitForm},"ok"),u.a.createElement("span",null,n.errors.name))},re=function(){var e=b(O),t=Object(o.useState)(),n=Object(r.a)(t,2),a=n[0],c=n[1],i=Object(te.a)({initialValues:{name:""},onSubmit:function(t){var n=t.name;if(a)return e({background:a,name:n}).response}}),s=Object(o.useMemo)((function(){return function(e){var t=e.done;return u.a.createElement(ae,{setBackground:function(e){c(e),t()}})}}),[]),l=Object(o.useMemo)((function(){return{GalleryComp:s,formik:i,background:null===a||void 0===a?void 0:a.src}}),[s,i,a]);return u.a.createElement(u.a.Fragment,null,"".concat(i.isSubmitting),u.a.createElement(ne,l))},ae=function(e){var t=e.setBackground,n=Object(o.useCallback)((function(e){return t(e)}),[t]);return u.a.createElement($,{clickImage:n})};!function(e){e[e.Project=0]="Project",e[e.NewProject=1]="NewProject"}(I||(I={}));var ce=function(e){return u.a.createElement("div",{style:oe},e.view===I.Project?u.a.createElement(e.ProjectComp,null):e.view===I.NewProject?u.a.createElement(e.NewProjectComp,null):null)},oe={position:"absolute",left:0,bottom:0,top:0,right:0,overflow:"hidden"},ue=n(13),ie=n.n(ue),se=!1,le=Object(o.createContext)({transform:{pos:{x:0,y:0},scale:1}});function fe(e){var t=Object(o.useContext)(le),n=Object(o.useState)(1),a=Object(r.a)(n,2),c=a[0],i=a[1],s=Object(o.useRef)(c),l=Object(o.useState)({x:0,y:0}),f=Object(r.a)(l,2),m=f[0],d=f[1],b=Object(o.useRef)(m),p=Object(o.useState)(null),v=Object(r.a)(p,2),h=v[0],j=v[1],g=Object(o.useRef)((function(){e.current&&(e.current.style.transform="scale(".concat(s.current,") translate(").concat(b.current.x,"px,").concat(b.current.y,"px)"))})).current;Object(o.useEffect)(g,[]);var O=Object(o.useRef)(!1);return Object(o.useEffect)((function(){h&&!O.current&&(h.add(new ie.a.Pinch({event:"pinch"})),h.on("pinchstart",(function(e){if(!se){se=!0;var n=b.current.x*s.current,r=b.current.y*s.current,a=s.current,c=function(e){var c=e.scale;s.current=c*a,b.current={x:n/s.current*t.transform.scale,y:r/s.current*t.transform.scale},g()};h.on("pinchend",(function e(){i(s.current),d(b.current),h.off("pinchend",e),h.off("pinch",c),setTimeout((function(){return se=!1}),10)})),h.on("pinch",c)}})),h.add(new ie.a.Pan({event:"pan",interval:1e3})),h.on("panstart",(function(e){if(!se){se=!0;var n=b.current.x,r=b.current.y,a=function(e){var a=e.deltaX,c=e.deltaY;b.current={x:n+a/s.current*t.transform.scale,y:r+c/s.current*t.transform.scale},g()};h.on("panend",(function e(){h.off("pan",a),h.off("panend",e),d(b.current),setTimeout((function(){return se=!1}),10)})),h.on("pan",a)}})),O.current=!0)}),[h,t.transform.scale,g]),Object(o.useEffect)((function(){if(e.current){var t=new ie.a.Manager(e.current,{domEvents:!0});return j(t),function(){O.current=!1,t.destroy()}}}),[e]),Object(o.useMemo)((function(){var e={scale:c,pos:m},n={transform:{pos:{x:m.x+t.transform.pos.x,y:m.y+t.transform.pos.y},scale:c*t.transform.scale}};return[e,function(e){var t=e.children;return u.a.createElement(le.Provider,{value:n},t)}]}),[t.transform.pos.x,t.transform.pos.y,t.transform.scale,m,c])}var me=function(e){var t=e.background,n=e.Objects,a=Object(o.useRef)(null),c=fe(a),i=Object(r.a)(c,2)[1],s=be(t),l=Object(o.useMemo)((function(){return Object(v.a)({},de,{backgroundImage:"url(".concat(t.src,")"),width:"".concat(s.width,"px"),height:"".concat(s.height,"px")})}),[t,s]);return u.a.createElement(i,null,u.a.createElement("div",{ref:a,style:l},n.map((function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return u.a.createElement(a,{key:n})}))))},de={backgroundRepeat:"no-repeat",backgroundSize:"contain",margin:"auto",position:"absolute",left:0,bottom:0,top:0,right:0,overflow:"hidden"},be=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(o.useMemo)((function(){return pe(e,t)}),[e,t])};function pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n={height:window.innerHeight,width:window.innerWidth},r=ve(e,n),a={height:e.height*r*t,width:e.width*r*t};return console.table({ratio:r,clientDim:n,dim:e,result:a}),a}var ve=function(e,t){return Math.min(t.height/e.height,t.width/e.width)},he=function(){var e=U().project,t=Object(o.useMemo)((function(){if(!e)return null;var t=e.objects.map((function(e){return[e.image.src,function(){return je({obj:e})}]}));return{background:e.background,Objects:t}}),[e]);return t&&u.a.createElement(me,t)},je=function(e){var t=e.obj,n=Object(o.useRef)(null);fe(n);var r=be(t.image,.25),a=Object(o.useMemo)((function(){return Object(v.a)({},r)}),[r]);return u.a.createElement("img",{ref:n,alt:t.image.name,src:t.image.src,style:a})},ge=function(){var e=U().project,t=Object(o.useMemo)((function(){return e?{ProjectComp:function(){return u.a.createElement(he,null)},view:I.Project}:{NewProjectComp:function(){return u.a.createElement(re,null)},view:I.NewProject}}),[e]);return u.a.createElement(ce,t)},Oe=n(22),ye=n.n(Oe);n(36);ye.a.render(u.a.createElement((function(){var e=G();return u.a.createElement(l,{mw:e.mw},u.a.createElement(J,{srvcs:e},u.a.createElement(ge,null)))}),null),document.getElementById("root")),navigator.serviceWorker.register("sw.js")}},[[26,1,2]]]);
//# sourceMappingURL=main.bb4076aa.chunk.js.map