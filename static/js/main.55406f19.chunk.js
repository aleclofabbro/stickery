(this.webpackJsonpstickery=this.webpackJsonpstickery||[]).push([[0],{103:function(e,t){},104:function(e,t){},105:function(e,t){},115:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(8),o=n.n(i),u=(n(44),function(e){var t=e.Canvas,n=e.TopBar;return c.a.createElement("div",{style:l},c.a.createElement("div",{style:s},n),c.a.createElement("div",{style:d},t))}),l={display:"grid",gridTemplate:'\n  "top-bar" 20px\n  "canvas" auto\n  '},s={gridArea:"top-bar",backgroundColor:"#262626"},d={gridArea:"canvas",backgroundColor:"#1a1a1a"},f=function(e){var t=e.onClick,n=e.style,a=e.children;return c.a.createElement("button",{onClick:t,style:n},a)},m=function(e){var t=e.onClick,n=e.children;return c.a.createElement(f,{style:b,onClick:t},n)},b={float:"left",backgroundColor:"gray"},v=function(e){var t=e.onClickOut,n=e.children,a=Object(r.useRef)(null);Object(r.useEffect)((function(){if(a.current){var e=a.current,t=a.current.parentElement;return document.body.appendChild(e),function(){t&&t.appendChild(e)}}}),[]);var i,o=(i=t,Object(r.useEffect)((function(){window.history.pushState({},"");var e=function(){i()};return window.addEventListener("popstate",e),function(){window.removeEventListener("popstate",e)}}),[i]),Object(r.useMemo)((function(){return{back:function(){window.history.back()}}}),[])).back,u=Object(r.useCallback)((function(e){e.target===e.currentTarget&&(o(),t())}),[t,o]);return c.a.createElement("div",{id:"modal",ref:a,style:p,onClick:u},c.a.createElement("div",{style:g},n))},g={position:"fixed",left:"5%",top:"5%",right:"5%",bottom:"5%",backgroundColor:"#1a1a1a"},p={position:"fixed",left:0,top:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.7)"},E=function(e){var t=e.closeModal,n=e.isModalOpen,a=e.openModal,r=e.Gallery;return c.a.createElement(c.a.Fragment,null,c.a.createElement(m,{onClick:a},"Sticker"),n&&c.a.createElement(v,{onClickOut:t},r))},O=n(2),h=n(9),j=n.n(h),k=n(36),y=n(32),C=n(37),w=n(33),M=n(38),x=n(34),S=function(e,t){return"/_/images/".concat(t,"/").concat(e)},L=new(function(e){function t(){var e;return Object(y.a)(this,t),(e=Object(C.a)(this,Object(w.a)(t).call(this,"Stickery"))).imageData=void 0,e.imageMeta=void 0,e.version(1).stores({imageData:"++id, blob",imageMeta:"id,src, name, type, size, lastModified"}),e.imageData=e.table("imageData"),e.imageMeta=e.table("imageMeta"),e}return Object(M.a)(t,e),t}(x.a)),I=function(e){var t,n,a;return j.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,j.a.awrap(e.arrayBuffer());case 2:return r.t0=r.sent,t={blob:r.t0},r.next=6,j.a.awrap(L.imageData.add(t));case 6:return n=r.sent,a={size:e.size,lastModified:e.lastModified,name:e.name,type:e.type,src:S(e.name,n),id:n},r.next=10,j.a.awrap(L.imageMeta.add(a));case 10:return r.abrupt("return",Promise.resolve(a));case 11:case"end":return r.stop()}}))},T=n(49),D=function(e){var t=e.onClickImage,n=function(){var e=Object(r.useState)([]),t=Object(O.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){L.imageMeta.toArray().then(a)}),[]),Object(r.useEffect)((function(){var e=function(e,t,r){a([t].concat(Object(k.a)(n)))},t=L.imageMeta.hook("creating");return t.subscribe(e),function(){t.unsubscribe(e)}}),[n]),Object(r.useMemo)((function(){return{images:n,add:I}}),[n])}(),a=n.images,i=function(e){var t=e.onFileChoosen,n=Object(r.useRef)(null),a=Object(r.useCallback)((function(){return n.current&&n.current.click()}),[]);return Object(r.useEffect)((function(){var e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none";var a=function(){var n=e.files&&e.files.length>0&&e.files[0];n&&t(n,"fs")};return e.addEventListener("change",a),document.body.appendChild(e),n.current=e,function(){e.removeEventListener("change",a),document.body.removeChild(e),n.current=null}}),[t]),Object(r.useEffect)((function(){var e=function(e){var n=e.clipboardData;if(n&&n.files&&n.files.length>0){var a=n.files[0];t(a,"paste")}};return document.body.addEventListener("paste",e),function(){document.body.removeEventListener("paste",e)}}),[t]),Object(r.useEffect)((function(){var e=function(e){var n=e.dataTransfer;if(n&&n.files.length>0){var a=n.files[0];t(a,"paste")}};return document.body.addEventListener("drop",e),function(){document.body.removeEventListener("drop",e)}}),[t]),[a]}({onFileChoosen:n.add}),o=Object(O.a)(i,1)[0],u=Object(r.useMemo)((function(){return a.map((function(e){return{meta:e,src:e.src,thumbnail:e.src,thumbnailWidth:0,thumbnailHeight:0}}))}),[a]),l=Object(r.useCallback)((function(){t(this.props.item.meta)}),[t]);return c.a.createElement("div",{style:F},c.a.createElement("div",{style:R},c.a.createElement(f,{onClick:o},"scegli file"),c.a.createElement("br",null),c.a.createElement("span",null,"o incolla")),c.a.createElement("div",{style:B},c.a.createElement(T,Object.assign({},A,{images:u,onClickThumbnail:l}))))},A={enableImageSelection:!1},F={display:"grid",gridTemplate:'\n  "head" 20px\n  "gallery" auto\n  ',position:"absolute",top:0,bottom:0},R={gridArea:"head"},B={gridArea:"gallery",overflowY:"auto",overflowX:"hidden"},z=n(11),W=n(7),G=n(35),J=n.n(G),P=Object(r.createContext)({}),U=Object(r.createContext)(null),H=function(e){var t=e.children,n=e.setState,a=Object(r.useState)(null),i=Object(O.a)(a,2),o=i[0],u=i[1],l=Object(r.useMemo)((function(){if(!o)return null;return{setBackground:function(e){W.fabric.Image.fromURL(e,(function(e){o.setBackgroundImage(e,(function(){Z(o),n(o.toDatalessJSON())}))}))},addSticker:function(e){W.fabric.Image.fromURL(e,(function(e){e.scaleToWidth(window.innerWidth/5),o.add(e),Z(o),n(o.toDatalessJSON())}))}}}),[o,n]),s=Object(r.useMemo)((function(){return{setCanvas:u}}),[]);return c.a.createElement(P.Provider,{value:s},c.a.createElement(U.Provider,{value:l},t))},N=function(){return Object(r.useContext)(U)},Z=function(e){if(e){var t={height:window.innerHeight-20,width:window.innerWidth};e.setDimensions(t);var n=e.backgroundImage;"undefined"===typeof n?(e.setZoom(1),e.renderAll()):n instanceof W.fabric.Image?a(n):W.fabric.Image.fromURL(n,a)}function a(n){var a=Math.min(t.height/(n.height||1),t.width/(n.width||1));e.setZoom(a),e.renderAll()}},X={interactive:!0},Y=function(e){var t=e.opts,n=Object(r.useContext)(P),a=Object(r.useRef)();Object(r.useEffect)((function(){var e=J()((function(){a.current&&Z(a.current)}),10,{trailing:!0});return window.addEventListener("resize",e,!1),function(){window.removeEventListener("resize",e,!1)}}),[]);var i=Object(r.useRef)(null);return Object(r.useEffect)((function(){if(!a.current){var e=i.current;e&&(a.current=new W.fabric.Canvas(e,Object(z.a)({},X,{},t)),Z(a.current),n.setCanvas(a.current))}}),[n,t]),c.a.createElement("canvas",{ref:i})},_=function(e){var t=Object(r.useState)(!1),n=Object(O.a)(t,2),a=n[0],c=n[1],i=Object(r.useCallback)((function(){return c(!1)}),[]),o=Object(r.useCallback)((function(){return c(!0)}),[]),u=Object(r.useCallback)((function(){return c(!a)}),[a]);return{b:a,T:o,F:i,t:u,s:c}},q=function(){var e=_(),t=e.b,n=e.T,a=e.F,i=N(),o=Object(r.useCallback)((function(e){null===i||void 0===i||i.addSticker(e.src),a()}),[a,i]),u=Object(r.useMemo)((function(){return c.a.createElement(D,{onClickImage:o})}),[o]);return c.a.createElement(E,{closeModal:a,isModalOpen:t,openModal:n,Gallery:u})},K=function(e){var t=e.closeModal,n=e.isModalOpen,a=e.openModal,r=e.Gallery;return c.a.createElement(c.a.Fragment,null,c.a.createElement(m,{onClick:a},"Sfondo"),n&&c.a.createElement(v,{onClickOut:t},r))},Q=function(){var e=_(),t=e.b,n=e.T,a=e.F,i=N(),o=Object(r.useCallback)((function(e){null===i||void 0===i||i.setBackground(e.src),a()}),[a,i]),u=Object(r.useMemo)((function(){return c.a.createElement(D,{onClickImage:o})}),[o]);return c.a.createElement(K,{closeModal:a,isModalOpen:t,openModal:n,Gallery:u})},V=function(){return c.a.createElement("div",{style:$},c.a.createElement(Y,null))},$={},ee=n(12),te=function(e,t){return ne(e,t)},ne=function(e,t){switch(t.t){case"bg":return ae(e,t.p)}return e},ae=(a="background",function(e,t){return Object(z.a)({},e,Object(ee.a)({},a,t))}),re={background:null},ce=Object(r.createContext)({}),ie=function(e){var t=e.children,n=Object(r.useReducer)(te,re),a=Object(O.a)(n,2),i={state:a[0],dispatch:a[1]};return c.a.createElement(ce.Provider,{value:i},t)};o.a.render(c.a.createElement((function(e){var t=e.children;return c.a.createElement(ie,null,t)}),null,c.a.createElement((function(){var e=Object(r.useMemo)((function(){return{TopBar:c.a.createElement(c.a.Fragment,null,c.a.createElement(Q,null),c.a.createElement(q,null)),Canvas:c.a.createElement(V,null)}}),[]);return c.a.createElement(H,{setState:console.log},c.a.createElement(u,e))}),null)),document.getElementById("root")),navigator.serviceWorker.register("sw.js")},39:function(e,t,n){e.exports=n(115)},44:function(e,t,n){}},[[39,1,2]]]);
//# sourceMappingURL=main.55406f19.chunk.js.map