(this.webpackJsonpstickery=this.webpackJsonpstickery||[]).push([[0],{100:function(e,t){},101:function(e,t){},102:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(7),o=n.n(i),u=(n(40),function(e){var t=e.Canvas,n=e.TopBar;return c.a.createElement("div",{style:l},c.a.createElement("div",{style:s},n),c.a.createElement("div",{style:f},t))}),l={display:"grid",gridTemplate:'\n  "top-bar" 20px\n  "canvas" auto\n  '},s={gridArea:"top-bar",backgroundColor:"#262626"},f={gridArea:"canvas",backgroundColor:"#1a1a1a"},d=n(2),b=n(10),m=n(28),v=function(e,t){return g(e,t)},g=function(e,t){switch(t.t){case"bg":return p(e,t.p)}return e},p=(a="background",function(e,t){return Object(m.a)({},e,Object(b.a)({},a,t))}),h={background:null},E=Object(r.createContext)({}),O=function(){return Object(r.useContext)(E)},j=function(e){var t=e.children,n=Object(r.useReducer)(v,h),a=Object(d.a)(n,2),i={state:a[0],dispatch:a[1]};return c.a.createElement(E.Provider,{value:i},t)},k=function(e){var t=e.onClick,n=e.style,a=e.children;return c.a.createElement("button",{onClick:t,style:n},a)},y=function(e){var t=e.onClick,n=e.children;return c.a.createElement(k,{style:C,onClick:t},n)},C={float:"left",backgroundColor:"gray"},w=function(e){var t=e.onClickOut,n=e.children,a=Object(r.useRef)(null);Object(r.useEffect)((function(){if(a.current){var e=a.current,t=a.current.parentElement;return document.body.appendChild(e),function(){t&&t.appendChild(e)}}}),[]);var i,o=(i=t,Object(r.useEffect)((function(){window.history.pushState({},"");var e=function(){i()};return window.addEventListener("popstate",e),function(){window.removeEventListener("popstate",e)}}),[i]),Object(r.useMemo)((function(){return{back:function(){window.history.back()}}}),[])).back,u=Object(r.useCallback)((function(e){e.target===e.currentTarget&&(o(),t())}),[t,o]);return c.a.createElement("div",{id:"modal",ref:a,style:x,onClick:u},c.a.createElement("div",{style:M},n))},M={position:"fixed",left:"5%",top:"5%",right:"5%",bottom:"5%",backgroundColor:"#1a1a1a"},x={position:"fixed",left:0,top:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.7)"},L=function(e){var t=e.closeModal,n=e.isModalOpen,a=e.openModal,r=e.Gallery;return c.a.createElement(c.a.Fragment,null,c.a.createElement(y,{onClick:a},"Sfondo"),n&&c.a.createElement(w,{onClickOut:t},r))},T=n(8),A=n.n(T),D=n(32),S=n(29),F=n(33),I=n(30),z=n(34),B=n(31),R=function(e,t){return"/_/images/".concat(t,"/").concat(e)},W=new(function(e){function t(){var e;return Object(S.a)(this,t),(e=Object(F.a)(this,Object(I.a)(t).call(this,"Stickery"))).imageData=void 0,e.imageMeta=void 0,e.version(1).stores({imageData:"++id, blob",imageMeta:"id,src, name, type, size, lastModified"}),e.imageData=e.table("imageData"),e.imageMeta=e.table("imageMeta"),e}return Object(z.a)(t,e),t}(B.a)),G=function(e){var t,n,a;return A.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,A.a.awrap(e.arrayBuffer());case 2:return r.t0=r.sent,t={blob:r.t0},r.next=6,A.a.awrap(W.imageData.add(t));case 6:return n=r.sent,a={size:e.size,lastModified:e.lastModified,name:e.name,type:e.type,src:R(e.name,n),id:n},r.next=10,A.a.awrap(W.imageMeta.add(a));case 10:return r.abrupt("return",Promise.resolve(a));case 11:case"end":return r.stop()}}))},H=n(45),J=function(e){var t=e.onClickImage,n=function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){W.imageMeta.toArray().then(a)}),[]),Object(r.useEffect)((function(){var e=function(e,t,r){a([t].concat(Object(D.a)(n)))},t=W.imageMeta.hook("creating");return t.subscribe(e),function(){t.unsubscribe(e)}}),[n]),Object(r.useMemo)((function(){return{images:n,add:G}}),[n])}(),a=n.images,i=function(e){var t=e.onFileChoosen,n=Object(r.useRef)(null),a=Object(r.useCallback)((function(){return n.current&&n.current.click()}),[]);return Object(r.useEffect)((function(){var e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none";var a=function(){var n=e.files&&e.files.length>0&&e.files[0];n&&t(n,"fs")};return e.addEventListener("change",a),document.body.appendChild(e),n.current=e,function(){e.removeEventListener("change",a),document.body.removeChild(e),n.current=null}}),[t]),Object(r.useEffect)((function(){var e=function(e){var n=e.clipboardData;if(n&&n.files&&n.files.length>0){var a=n.files[0];t(a,"paste")}};return document.body.addEventListener("paste",e),function(){document.body.removeEventListener("paste",e)}}),[t]),Object(r.useEffect)((function(){var e=function(e){var n=e.dataTransfer;if(n&&n.files.length>0){var a=n.files[0];t(a,"paste")}};return document.body.addEventListener("drop",e),function(){document.body.removeEventListener("drop",e)}}),[t]),[a]}({onFileChoosen:n.add}),o=Object(d.a)(i,1)[0],u=Object(r.useMemo)((function(){return a.map((function(e){return{meta:e,src:e.src,thumbnail:e.src,thumbnailWidth:0,thumbnailHeight:0}}))}),[a]),l=Object(r.useCallback)((function(){t(this.props.item.meta)}),[t]);return c.a.createElement("div",{style:U},c.a.createElement("div",{style:X},c.a.createElement(k,{onClick:o},"scegli file"),c.a.createElement("br",null),c.a.createElement("span",null,"o incolla")),c.a.createElement("div",{style:Y},c.a.createElement(H,Object.assign({},P,{images:u,onClickThumbnail:l}))))},P={enableImageSelection:!1},U={display:"grid",gridTemplate:'\n  "head" 20px\n  "gallery" auto\n  ',position:"absolute",top:0,bottom:0},X={gridArea:"head"},Y={gridArea:"gallery",overflowY:"auto",overflowX:"hidden"},Z=function(){var e=O().dispatch,t=function(e){var t=Object(r.useState)(!1),n=Object(d.a)(t,2),a=n[0],c=n[1],i=Object(r.useCallback)((function(){return c(!1)}),[]),o=Object(r.useCallback)((function(){return c(!0)}),[]),u=Object(r.useCallback)((function(){return c(!a)}),[a]);return{b:a,T:o,F:i,t:u,s:c}}(),n=t.b,a=t.T,i=t.F,o=Object(r.useCallback)((function(t){e({t:"bg",p:t.src}),i()}),[i,e]),u=Object(r.useMemo)((function(){return c.a.createElement(J,{onClickImage:o})}),[o]);return c.a.createElement(L,{closeModal:i,isModalOpen:n,openModal:a,Gallery:u})},_=n(13),q={interactive:!0},K=null,N=function(){var e=Object(r.useRef)(null),t=function(){var e=O().state,t=Object(r.useState)(),n=Object(d.a)(t,2),a=n[0],c=n[1],i=Object(r.useCallback)((function(){var e=K;if(e&&a){var t={height:window.innerHeight-20,width:window.innerWidth},n=Math.min(t.height/(a.height||1),t.width/(a.width||1));e.setDimensions(t),e.setZoom(n),e.renderAll()}}),[a]);return Object(r.useEffect)((function(){return i()}),[a,i]),Object(r.useEffect)((function(){var t=K,n=e.background;t&&n&&_.fabric.Image.fromURL(n,(function(e){t.setBackgroundImage(e,(function(){c(e)}))}))}),[e.background]),Object(r.useEffect)((function(){return window.addEventListener("resize",i,!1),function(){window.removeEventListener("resize",i,!1)}}),[i]),Object(r.useMemo)((function(){return{set:function(e){var t=document.createElement("canvas");e.appendChild(t),K=new _.fabric.Canvas(t,q)}}}),[])}().set;return Object(r.useEffect)((function(){var n=e.current;n&&t(n)}),[t]),c.a.createElement("div",{style:Q,ref:e})},Q={};o.a.render(c.a.createElement((function(e){var t=e.children;return c.a.createElement(j,null,t)}),null,c.a.createElement((function(){var e=Object(r.useMemo)((function(){return{TopBar:c.a.createElement(c.a.Fragment,null,c.a.createElement(Z,null)),Canvas:c.a.createElement(N,null)}}),[]);return c.a.createElement(u,e)}),null)),document.getElementById("root")),navigator.serviceWorker.register("sw.js")},35:function(e,t,n){e.exports=n(102)},40:function(e,t,n){},99:function(e,t){}},[[35,1,2]]]);
//# sourceMappingURL=main.8036c3f8.chunk.js.map